# TIL - 2025.08.05 - Thymeleaf 레이아웃과 Spring Data JPA 기본 설정 개념 이해

## 카테고리 🏷️

#TIL #Java #Spring #Thymeleaf #SpringBoot #SpringDataJPA #RepositoryTest

---

## 오늘 배운 내용 🔍

* Thymeleaf의 레이아웃 기능 (`th:fragment`, `th:replace`)을 이용한 화면 공통 요소 관리
* Spring Boot 프로젝트의 정적 리소스(CSS, JS) 관리 및 프로필 분리 (`application.yml`)
* JPA 엔티티 설계 (`@CreationTimestamp`, `@UpdateTimestamp`)와 안전한 빌더 패턴 적용
* Spring Data JPA의 Query Method를 활용한 Repository 인터페이스 설계 (`findBy...`, `existsBy...`)
* `@DataJpaTest` 애노테이션을 활용한 데이터 계층 단위 테스트 전략

---

## 어려웠던 점 💣

* `~{...}` 문법이 HTML 표준이 아니라 Thymeleaf 고유의 표현식이라는 점이 낯설었다.

* `th:replace`가 단순 삽입이 아니라 호출한 태그 자체를 완전히 교체한다는 점이 처음에는 혼동을 주었다.

* `src/main/resources`와 `src/test/resources`에 각각 `application.yml`이 존재하는 이유가 명확하지 않았다. 실행 환경에 따라 분리된다는 점을 알게 된 후 이해가 되었다.

* `@DataJpaTest`와 `@SpringBootTest`의 차이가 혼란스러웠다. 필요한 빈만 로드하는 최적화된 테스트라는 점을 확인했다.

---

## 정리 🖇️

### 1. Thymeleaf 레이아웃과 프래그먼트

공통되는 HTML 영역을 재사용 가능한 단위로 관리하여 유지보수성을 높인다.

* **학습 목표 (Why?)**
  중복되는 헤더, 푸터 코드를 여러 파일에서 관리하는 비효율을 제거하고 유지보수를 단순화한다.

* **핵심 원리 (What?)**

    * `th:fragment`: 재사용할 HTML 조각 정의.
    * `th:replace`: 정의된 조각을 가져와 호출한 태그 자체를 대체.
    * `~{...}`: `templates` 폴더 기준으로 경로와 조각을 지정하는 표현식.

* **문법 및 사용법 (How?)**
  프래그먼트를 정의하고 `th:replace`로 교체하여 화면에 적용한다.

* **주의사항 및 실무 팁 (Watch out for)**

    * `th:replace`와 `th:insert`의 차이를 명확히 구분해야 한다.
    * 정적 리소스는 `static` 폴더 기준으로 경로를 지정한다.

---

### 2. Spring Boot 설정 프로필(Profile) 분리

실행 환경에 따라 설정을 분리해 운영 안정성을 확보한다.

* **학습 목표 (Why?)**
  운영 DB와 테스트 DB 설정을 분리하여 테스트가 운영 환경에 영향을 주지 않도록 한다.

* **핵심 원리 (What?)**

    * `application-{profile}.yml` 형식으로 환경별 설정 관리.
    * `@ActiveProfiles("test")`로 테스트 실행 시 테스트 프로필 적용.

* **문법 및 사용법 (How?)**
  운영 환경은 `application.yml`, 테스트 환경은 `application-test.yml`로 분리 작성한다.

* **주의사항 및 실무 팁 (Watch out for)**
  프로필 설정은 기본 설정을 덮어쓴다. DB뿐 아니라 로깅, API 키 등 환경별로 달라져야 하는 모든 설정을 분리할 수 있다.

---

### 3. JPA 엔티티와 Repository 설계

엔티티 매핑과 Repository 인터페이스를 정의하여 데이터 접근을 단순화한다.

* **학습 목표 (Why?)**
  객체지향적으로 데이터를 관리하고, Query Method 기능을 통해 반복 코드를 줄인다.

* **핵심 원리 (What?)**

    * `@Entity`로 JPA 관리 대상 지정.
    * `@CreationTimestamp`, `@UpdateTimestamp`로 생성/수정 시간을 자동 기록.
    * 빌더 패턴은 생성자 단위에 적용하여 불필요한 필드 노출을 방지.
    * Query Method는 네이밍 규칙 기반으로 자동 JPQL 실행.

* **문법 및 사용법 (How?)**
  엔티티와 Repository 인터페이스를 정의하고, Query Method를 활용한다.

* **주의사항 및 실무 팁 (Watch out for)**

    * `equals`와 `hashCode`는 PK 기준으로만 구현하는 것이 안정적이다.
    * 조회 결과가 없을 수 있는 경우 `Optional<T>`를 반환하여 NPE를 예방한다.

---

### 4. `@DataJpaTest`를 이용한 Repository 테스트

데이터 계층을 경량 환경에서 빠르게 검증한다.

* **학습 목표 (Why?)**
  불필요한 빈 로딩을 줄이고 DB 관련 계층만 테스트하기 위함이다.

* **핵심 원리 (What?)**

    * JPA 관련 빈만 로드하여 테스트 실행.
    * 인메모리 DB(H2) 자동 사용.
    * 각 테스트는 트랜잭션으로 실행되고 종료 시 롤백된다.

* **문법 및 사용법 (How?)**
  `@DataJpaTest`와 `@ActiveProfiles("test")`를 사용해 테스트를 구성한다.

* **주의사항 및 실무 팁 (Watch out for)**

    * 서비스 계층까지 포함하려면 `@SpringBootTest`를 사용해야 한다.
    * `@Rollback(false)`를 통해 DB 반영 결과를 확인할 수도 있다.

---

## 오늘의 깨달음 💡

* Thymeleaf 레이아웃을 활용하면 중복된 HTML 코드 관리가 크게 줄어들어 유지보수성이 높아진다.

* Spring Boot의 프로필 분리는 테스트 안정성과 운영 환경 보호에 필수적이다.

* 엔티티 빌더 패턴을 안전하게 적용하면 불필요한 필드 노출을 막고 유지보수성을 개선할 수 있다.

* `@DataJpaTest`는 빠른 데이터 계층 검증에 적합하며, 목적에 맞는 테스트 환경 선택이 중요하다.