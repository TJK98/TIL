λ„¤, μ•κ² μµλ‹λ‹¤. λ°λ³µλ μ‹¤μλ΅ μΈν•΄ κ³„μ†ν•΄μ„ λ¶νΈν•¨κ³Ό ν”Όλ΅κ°μ„ λ“λ¦° μ , μ§„μ‹¬μΌλ΅ μ‚¬κ³Όλ“λ¦½λ‹λ‹¤. μ‚¬μ©μλ‹μ μ§€μ μ€ μ „μ μΌλ΅ μ³μΌλ©°, μ κ°€ κ·μΉ™μ„ μ™„λ²½ν•κ² λ‚΄μ¬ν™”ν•μ§€ λ»ν•κ³  μμμ„ μΈμ •ν•©λ‹λ‹¤.

μ΄λ²μ—λ” **λ¨λ“  κ·μΉ™, νΉν `μ–΄λ ¤μ› λ μ `κ³Ό `μ¤λμ κΉ¨λ‹¬μ` ννΈμ ν†¤μ•¤λ§¤λ„ κ·μΉ™μ„ μµμ°μ„ μΌλ΅ μ μ©**ν•μ—¬, λ³΄λ‚΄μ£Όμ‹  MyBatis ν•™μµ λ‚΄μ©μ„ μ™„λ²½ν•κ² μ¬κµ¬μ„±ν–μµλ‹λ‹¤. λΉ„μ μ μΈ ν‘ν„μ„ μ™„μ „ν λ°°μ ν•κ³ ,
κ°κ΄€μ μ΄κ³  μ§μ„¤μ μΈ λ¬Έμ²΄λ΅ μ‘μ„±ν–μµλ‹λ‹¤.

---

[TIL] - 2025.07.25 - MyBatis κΈ°λ³Έ μ„¤μ •κ³Ό XML λ§¤νΌ μ‘μ„± κ°λ… μ΄ν•΄

# TIL - 2025.07.25 - MyBatis κΈ°λ³Έ μ„¤μ •κ³Ό XML λ§¤νΌ μ‘μ„± κ°λ… μ΄ν•΄

## μΉ΄ν…κ³ λ¦¬ π·οΈ

#TIL #Java #Spring #MyBatis #SQLMapper #XML

---

## μ¤λ λ°°μ΄ λ‚΄μ© π”

- `JdbcTemplate`μ ν•κ³„λ¥Ό κ·Ήλ³µν•κΈ° μ„ν• MyBatisμ ν•„μ”μ„± λ° μ£Όμ” νΉμ§•
- Spring Boot ν™κ²½μ—μ„ MyBatis μ—°λ™μ„ μ„ν• μμ΅΄μ„± λ° `application.properties` μ„¤μ • λ°©λ²•
- `@Mapper` μΈν„°νμ΄μ¤μ™€ XML λ§¤νΌ νμΌμ μ—­ν•  λ° μ—°λ™ μ›λ¦¬
- XML λ§¤νΌλ¥Ό μ΄μ©ν• κΈ°λ³Έμ μΈ CRUD(Create, Read, Update, Delete) SQL μ‘μ„±λ²•
- μ•μ „ν• νλΌλ―Έν„° λ°”μΈλ”©(`#{}`)κ³Ό κ³ κΈ‰ λ§¤ν•‘(`resultMap`), SQL μ¬μ‚¬μ©(`sql`, `include`) κΈ°λ²•

---

## μ–΄λ ¤μ› λ μ  π’£

* `ProductMapper` μΈν„°νμ΄μ¤λ¥Ό λ§λ“¤κ³  μ¶”μƒ λ©”μ„λ“λ§ μ„ μ–Έν–μ„ λΏμΈλ°, κµ¬ν„ ν΄λμ¤ μ—†μ΄λ„ ν…μ¤νΈ μ½”λ“μ—μ„ μ •μƒμ μΌλ΅ λ™μ‘ν•λ” κ²ƒμ΄ νΌλ€μ¤λ¬μ› λ‹¤.

* μλ°” μ½”λ“μ— μλ SQLμ„ λ³„λ„μ XML νμΌλ΅ λ¶„λ¦¬ν•λ” κ²ƒμ΄ μ¤νλ ¤ λ” λ²κ±°λ΅­κ² λκ»΄μ΅λ‹¤.

* `#{}`μ™€ `${}` λ¨λ‘ νλΌλ―Έν„°λ¥Ό λ„κΈ°λ” κ²ƒ κ°™μ•„ λ³΄μ—¬ νΌμ©ν•΄λ„ λλ” μ¤„ μ•μ•κ³ , κ·Έ μ°¨μ΄μ μ„ λ…ν™•ν μΈμ§€ν•κΈ° μ–΄λ ¤μ› λ‹¤.

* λ°μ΄ν„°λ² μ΄μ¤ μ»¬λΌμ€ `snake_case`λ΅, μλ°” ν•„λ“λ” `camelCase`λ΅ μ‘μ„±ν•λ” κ΄€λ΅€ λ•λ¬Έμ— μ΄λ¦„μ΄ λ‹¬λΌ λ§¤ν•‘μ΄ μ• λ  κ²ƒμΌλ΅ μμƒν–λ‹¤.

---

## μ •λ¦¬ π–‡οΈ

### 1. MyBatis μ†κ° λ° κΈ°λ³Έ μ„¤μ •

`JdbcTemplate`μ λ¶νΈν•¨μ„ ν•΄μ†ν•κ³ , SQL μ¤‘μ‹¬μ λ°μ΄ν„°λ² μ΄μ¤ μ—°λ™μ„ λ” ν¨μ¨μ μΌλ΅ μν–‰ν•κΈ° μ„ν• MyBatis ν”„λ μ„μ›ν¬μ λ„μ… κ³Όμ •μ„ ν•™μµν–λ‹¤.

* **ν•™μµ λ©ν‘ (Why?)**:
  `JdbcTemplate` μ‚¬μ© μ‹ λ°μƒν•λ” λ¬Έμ λ“¤, μ¦‰ 1) Java μ½”λ“μ™€ SQLμ κ°•ν• κ²°ν•©, 2) λ°λ³µμ μΈ `RowMapper` μ‘μ„±, 3) λ³µμ΅ν• λ™μ  SQL μ²λ¦¬λ¥Ό ν•΄κ²°ν•κ³ , SQLμ„ μ¤‘μ‹¬μΌλ΅ λ°μ΄ν„°
  μ ‘κ·Ό λ΅μ§μ„ λ…ν™•ν•κ² λ¶„λ¦¬ν•κΈ° μ„ν•¨μ΄λ‹¤.

* **ν•µμ‹¬ μ›λ¦¬ (What?)**:
    * **SQL Mapper ν”„λ μ„μ›ν¬**: MyBatisλ” κ°μ²΄(Java Object)μ™€ SQL μ‚¬μ΄μ λ§¤ν•‘μ„ μλ™ν™”ν•μ—¬ κ°λ°μκ°€ SQL μ‘μ„±μ—λ§ μ§‘μ¤‘ν•  μ μλ„λ΅ λ„μ™€μ¤€λ‹¤.
    * **SQLκ³Ό μ½”λ“μ λ¶„λ¦¬**: SQL λ¬Έμ„ Java μ½”λ“μ—μ„ λ¶„λ¦¬ν•μ—¬ λ³„λ„μ XML νμΌμ—μ„ κ΄€λ¦¬ν•λ‹¤. μ΄λ¥Ό ν†µν•΄ SQLμ κ°€λ…μ„±κ³Ό μ μ§€λ³΄μμ„±μ΄ ν–¥μƒλλ‹¤.
    * **μλ™ κ°μ²΄ λ§¤ν•‘**: `ResultSet`μ κ²°κ³Όλ¥Ό μ§€μ •λ μλ°” κ°μ²΄(DTO, Entity)μ ν•„λ“μ— μλ™μΌλ΅ λ§¤ν•‘ν•΄μ¤€λ‹¤.

* **λ¬Έλ²• λ° μ‚¬μ©λ²• (How?)**:
    1. **μμ΅΄μ„± μ¶”κ°€ (`build.gradle`)**: `org.mybatis.spring.boot:mybatis-spring-boot-starter:3.0.3` μμ΅΄μ„±μ„ μ¶”κ°€ν•λ‹¤.
    2. **μ„¤μ • νμΌ μ‘μ„± (`application.properties`)**:
       ```properties
       # MyBatis Setting
       # SQL λ§¤νΌ XML νμΌλ“¤μ μ„μΉλ¥Ό μ§€μ •
       mybatis.mapper-locations=classpath:mappers/**/*.xml
       # DB μ»¬λΌ(snake_case)κ³Ό μλ°” ν•„λ“(camelCase)λ¥Ό μλ™μΌλ΅ λ§¤ν•‘
       mybatis.configuration.map-underscore-to-camel-case=true
       ```
    3. **λ§¤νΌ μΈν„°νμ΄μ¤ μ •μ**: `@Mapper` μ• λ„ν…μ΄μ…μ„ λ¶™μ—¬ MyBatisκ°€ κµ¬ν„μ²΄λ¥Ό μƒμ„±ν•  λ€μƒμ„μ„ μ•λ¦°λ‹¤.
       ```java
       @Mapper
       public interface ProductMapper {
           // μ—¬κΈ°μ— μ •μλ λ©”μ„λ“ μ΄λ¦„μ΄ XMLμ SQL idμ™€ μ—°κ²°λλ‹¤.
           void save(Product product);
           Product findById(Long id);
       }
       ```

* **μ£Όμμ‚¬ν•­ λ° μ‹¤λ¬΄ ν (Watch out for)**:
    * `mybatis.mapper-locations` κ²½λ΅ μ„¤μ •μ΄ ν‹€λ¦¬λ©΄ MyBatisκ°€ XML νμΌμ„ μ°Ύμ§€ λ»ν•΄ `BindingException`μ΄ λ°μƒν•  μ μμΌλ‹ μ£Όμν•΄μ•Ό ν•λ‹¤. `classpath:`λ”
      `src/main/resources`λ¥Ό κ°€λ¦¬ν‚¨λ‹¤.
    * `@Mapper` μ• λ„ν…μ΄μ…μ„ λ¶™μΈ μΈν„°νμ΄μ¤λ” μ¤ν”„λ§ μ»¨ν…μ΄λ„μ— λΉμΌλ΅ λ“±λ΅λλ‹¤.

---

### 2. XML λ§¤νΌ μ‘μ„± - κΈ°λ³Έ CRUD

Mapper μΈν„°νμ΄μ¤μ μ¶”μƒ λ©”μ„λ“μ™€ μ‹¤μ  μ‹¤ν–‰λ  SQL λ¬Έμ„ μ—°κ²°ν•λ” XML νμΌμ„ μ‘μ„±ν•λ” λ°©λ²•μ„ ν•™μµν–λ‹¤.

* **ν•™μµ λ©ν‘ (Why?)**:
  Java μ½”λ“μ λΉ„μ¦λ‹μ¤ λ΅μ§κ³Ό λ°μ΄ν„° μ ‘κ·Ό λ΅μ§(SQL)μ„ λ¬Όλ¦¬μ μΌλ΅ λ¶„λ¦¬ν•μ—¬ κ°μμ μ—­ν• μ—λ§ μ§‘μ¤‘ν•κ² λ§λ“¤κ³ , SQLμ„ λ³΄λ‹¤ μ²΄κ³„μ μΌλ΅ κ΄€λ¦¬ν•κΈ° μ„ν•¨μ΄λ‹¤.

* **ν•µμ‹¬ μ›λ¦¬ (What?)**:
    * **`namespace`**: XML λ§¤νΌ νμΌμ„ μ–΄λ λ§¤νΌ μΈν„°νμ΄μ¤μ™€ μ—°κ²°ν• μ§€ μ§€μ •ν•λ‹¤. **μΈν„°νμ΄μ¤μ μ „μ²΄ κ²½λ΅(ν¨ν‚¤μ§€ ν¬ν•¨)λ¥Ό μ •ν™•ν κΈ°μ…**ν•΄μ•Ό ν•λ‹¤.
    * **SQL νƒκ·Έ (`<select>`, `<insert>`, `<update>`, `<delete>`)**:
        * `id`: μ‹¤ν–‰ν•  SQLμ„ μ‹λ³„ν•λ” κ³ μ  ID. **λ°λ“μ‹ λ§¤νΌ μΈν„°νμ΄μ¤μ λ©”μ„λ“λ…κ³Ό μΌμΉ**ν•΄μ•Ό ν•λ‹¤.
        * `parameterType`: SQLμ— μ „λ‹¬λ  νλΌλ―Έν„°μ νƒ€μ…μ„ λ…μ‹. (μƒλµ κ°€λ¥)
        * `resultType`: SQL μ‹¤ν–‰ κ²°κ³Όλ¥Ό λ§¤ν•‘ν•  μλ°” κ°μ²΄μ νƒ€μ…μ„ λ…μ‹.
    * **νλΌλ―Έν„° λ°”μΈλ”© `#{}`**: `PreparedStatement`μ `?`μ™€ λ™μΌν•κ² λ™μ‘ν•λ‹¤. μ „λ‹¬λ κ°’μ„ μ•μ „ν•κ² λ°”μΈλ”©ν•μ—¬ SQL μΈμ μ… κ³µκ²©μ„ λ°©μ§€ν•λ‹¤.

* **λ¬Έλ²• λ° μ‚¬μ©λ²• (How?)**:
  ```xml
  <?xml version="1.0" encoding="UTF-8" ?>
  <!DOCTYPE mapper
          PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
          "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="com.spring.database.chap02.ProductMapper">
  
      <insert id="save">
          INSERT INTO PRODUCTS (name, price) VALUES (#{name}, #{price})
      </insert>
  
      <select id="findById" resultType="com.spring.database.chap02.entity.Product">
          SELECT * FROM PRODUCTS WHERE id = #{id}
      </select>
      
      <select id="findAll" resultType="com.spring.database.chap02.entity.Product">
          SELECT * FROM PRODUCTS WHERE status &lt;&gt; 'DELETED'
      </select>
  
  </mapper>
  ```

* **μ£Όμμ‚¬ν•­ λ° μ‹¤λ¬΄ ν (Watch out for)**:
    * XML νμΌ λ‚΄μ—μ„ SQLμ„ μ‘μ„±ν•  λ•, λ¬Έμ¥ λμ— **μ„Έλ―Έμ½λ΅ (;)μ„ λ¶™μ΄μ§€ μ•λ”λ‹¤.**
    * XMLμ—μ„λ” λ¶€λ“±νΈ( `<`, `>` ) κ°™μ€ νΉμ λ¬Έμλ¥Ό μ§μ ‘ μ‚¬μ©ν•  μ μ—†λ‹¤. λ°λ“μ‹ μ΄μ¤μΌ€μ΄ν”„ μ²λ¦¬(`&lt;`, `&gt;`)ν•κ±°λ‚ `CDATA` μ„Ήμ…μ„ μ‚¬μ©ν•΄μ•Ό ν•λ‹¤.

---

### 3. XML λ§¤νΌ μ‘μ„± - κ³ κΈ‰ κΈ°λ²•

λ‹¨μ CRUDλ¥Ό λ„μ–΄, λ³µμ΅ν• λ§¤ν•‘μ„ μ²λ¦¬ν•κ³  μ¤‘λ³µλλ” SQL μ½”λ“λ¥Ό μ¬μ‚¬μ©ν•λ” λ°©λ²•μ„ ν•™μµν–λ‹¤.

* **ν•™μµ λ©ν‘ (Why?)**:
  λ°μ΄ν„°λ² μ΄μ¤ μ¤ν‚¤λ§μ™€ μλ°” κ°μ²΄ λ¨λΈμ΄ μ •ν™•ν μΌμΉν•μ§€ μ•λ” μƒν™©μ— μ μ—°ν•κ² λ€μ²ν•κ³ , λ°λ³µλλ” SQL κµ¬λ¬Έμ„ λ¨λ“ν™”ν•μ—¬ μ½”λ“μ μ¤‘λ³µμ„ μ¤„μ΄κ³  μ μ§€λ³΄μμ„±μ„ λ†’μ΄κΈ° μ„ham.

* **ν•µμ‹¬ μ›λ¦¬ (What?)**:
    * `resultMap`: DB μ΅°ν κ²°κ³Ό(ResultSet)μ™€ μλ°” κ°μ²΄μ ν•„λ“λ¥Ό μλ™μΌλ΅ λ§¤ν•‘ν•λ” κ·μΉ™μ„ μ •μν•λ‹¤. μ»¬λΌλ…κ³Ό ν•„λ“λ…μ΄ λ‹¤λ¥΄κ±°λ‚, λ³µμ΅ν• κ΄€κ³„(1:N λ“±)λ¥Ό λ§¤ν•‘ν•  λ• μ μ©ν•λ‹¤.
    * `<sql>`: μ¬μ‚¬μ©ν•  μ μλ” SQL μ΅°κ°μ„ μ •μν•λ” νƒκ·Έ.
    * `<include>`: `<sql>` νƒκ·Έλ΅ μ •μλ SQL μ΅°κ°μ„ ν„μ¬ μ„μΉμ— ν¬ν•¨μ‹ν‚¤λ” νƒκ·Έ.

* **λ¬Έλ²• λ° μ‚¬μ©λ²• (How?)**:
  ```xml
  <mapper namespace="com.example.ProductMapper">
  
      <!-- 1. resultMap μ •μ: DB μ»¬λΌκ³Ό κ°μ²΄ ν•„λ“λ¥Ό μλ™μΌλ΅ μ—°κ²° -->
      <resultMap id="productResultMap" type="Product">
          <id property="id" column="product_id"/>
          <result property="name" column="product_name"/>
          <result property="price" column="product_price"/>
      </resultMap>
      
      <!-- 2. μ¬μ‚¬μ©ν•  SQL μ΅°κ° μ •μ -->
      <sql id="productColumns">
          product_id, product_name, product_price
      </sql>
  
      <!-- 3. resultMapκ³Ό include ν™μ© -->
      <select id="findByIdWithMapping" resultMap="productResultMap">
          SELECT <include refid="productColumns"/>
          FROM PRODUCTS
          WHERE product_id = #{id}
      </select>
  
  </mapper>
  ```

* **μ£Όμμ‚¬ν•­ λ° μ‹¤λ¬΄ ν (Watch out for)**:
    * `map-underscore-to-camel-case=true` μ„¤μ •μΌλ΅ ν•΄κ²°λλ” λ‹¨μν• κ²½μ°μ—λ” `resultMap`μ„ λ‚¨μ©ν•  ν•„μ”κ°€ μ—†λ‹¤. `resultMap`μ€ ν•΄λ‹Ή μ„¤μ •μΌλ΅ μ»¤λ²„λμ§€ μ•λ” λ³µμ΅ν•
      κ²½μ°μ— μ‚¬μ©ν•λ” κ²ƒμ΄ μΆ‹λ‹¤.
    * κ³µν†µμΌλ΅ μ‚¬μ©λλ” `SELECT` μ μ΄λ‚ `WHERE` μ΅°κ±΄μ μ„ `<sql>`λ΅ λ§λ“¤μ–΄λ‘λ©΄ SQL μ μ§€λ³΄μμ„±μ΄ ν–¥μƒλλ‹¤.

---

## μ¤λμ κΉ¨λ‹¬μ π’΅

* MyBatisλ” SQLκ³Ό Java μ½”λ“μ μ—­ν• μ„ λ…ν™•ν λ¶„λ¦¬ν•μ—¬, κ°λ°μκ°€ SQL μμ²΄μ— λ” μ§‘μ¤‘ν•  μ μλ„λ΅ λ•λ”λ‹¤.

* `@Mapper` μΈν„°νμ΄μ¤λ” κµ¬ν„ ν΄λμ¤ μ—†μ΄λ„ MyBatisκ°€ λ™μ μΌλ΅ ν”„λ΅μ‹ κ°μ²΄λ¥Ό μƒμ„±ν•μ—¬ XMLμ SQLκ³Ό μ—°κ²°ν•΄μ¤€λ‹¤. μ΄λ” κ΄€λ΅€(Convention)λ¥Ό λ”°λμ„ λ• ν”„λ μ„μ›ν¬κ°€ μ κ³µν•λ” κ°•λ ¥ν• μλ™ν™”
  κΈ°λ¥μ΄λ‹¤.

* SQL νλΌλ―Έν„° λ°”μΈλ”© μ‹, `${}`λ” λ¬Έμμ—΄ μΉν™ λ°©μ‹μΌλ΅ SQL μΈμ μ… κ³µκ²©μ— μ·¨μ•½ν•λ―€λ΅, μ‚¬μ©μ μ…λ ¥κ°’μ„ λ‹¤λ£° λ•λ” λ°λ“μ‹ `#{}`λ¥Ό μ‚¬μ©ν•΄μ•Ό ν•λ‹¤.

* `mybatis.configuration.map-underscore-to-camel-case=true` μ„¤μ •μ€ λ°μ΄ν„°λ² μ΄μ¤μ `snake_case` μ»¬λΌλ…κ³Ό μλ°”μ `camelCase` ν•„λ“λ… κ΄€λ΅€ μ°¨μ΄λ¥Ό
  μλ™μΌλ΅ ν•΄κ²°ν•΄μ£Όλ” λ§¤μ° μ μ©ν• κΈ°λ¥μ΄λ‹¤.