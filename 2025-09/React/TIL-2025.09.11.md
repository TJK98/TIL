# TIL - 2025.09.11 - OAuth2 ì†Œì…œ ë¡œê·¸ì¸(Google/Kakao)ê³¼ JWT ì¿ í‚¤ ì—°ë™, Axios ì„¤ì •ê³¼ fetch ë¹„êµ ê°œë… ì´í•´

## ì¹´í…Œê³ ë¦¬ ğŸ·ï¸

#TIL #Java #Spring #SpringSecurity #OAuth2 #JWT #Cookie #Axios #KakaoLogin #GoogleLogin

---

## ì˜¤ëŠ˜ ë°°ìš´ ë‚´ìš© ğŸ”

* Spring Security OAuth2 Clientë¡œ Google/Kakao ì†Œì…œ ë¡œê·¸ì¸ ì—°ë™ íë¦„ íŒŒì•…
* `CustomOAuth2UserService`ë¡œ ê³µê¸‰ìë³„ ì‚¬ìš©ì ì •ë³´ ë§¤í•‘ ë° DB ë™ê¸°í™”
* OAuth2 ì„±ê³µ/ì‹¤íŒ¨ í•¸ë“¤ëŸ¬ì—ì„œ JWT ë°œê¸‰/ì‚­ì œ í›„ HttpOnly ì¿ í‚¤ ì €ì¥ê³¼ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì²˜ë¦¬
* Access/Refresh ì—­í•  ë¶„ë¦¬ì™€ ì¬ë°œê¸‰ API(`/api/auth/refresh`) ì„¤ê³„
* ì¿ í‚¤ ë³´ì•ˆ í”Œë˜ê·¸(HttpOnly, Secure, SameSite)ì™€ ë§Œë£Œ ì œì–´(`maxAge` ì´ˆ ë‹¨ìœ„)
* í”„ë¡ íŠ¸ì—”ë“œ Axios ì¸ìŠ¤í„´ìŠ¤(`withCredentials`) êµ¬ì„±ê³¼ 401 ìë™ ì¬ë°œê¸‰ ì¸í„°ì…‰í„°
* Axiosì™€ fetch ì°¨ì´ì  ë¹„êµ ë° JWT ì¿ í‚¤ ì¸ì¦ ë§¥ë½ì—ì„œì˜ ì„ íƒ ê¸°ì¤€

---

## ì–´ë ¤ì› ë˜ ì  ğŸ’£

* Googleê³¼ Kakaoì˜ ì‘ë‹µ ìŠ¤í‚¤ë§ˆê°€ ë‹¬ë¼ providerë³„ ë§¤í•‘ ë¶„ê¸°ê°€ í•„ìš”í–ˆë‹¤.

* Kakaoì—ì„œ ì´ë©”ì¼ ë¯¸ë™ì˜ ì‹œ placeholder ì´ë©”ì¼ì„ ë„£ëŠ” ì •ì±…ì„ ì •í•˜ëŠ” ë° ì‹œê°„ì´ ê±¸ë ¸ë‹¤.

* OAuth2 ì„±ê³µ/ì‹¤íŒ¨ í•¸ë“¤ëŸ¬ì—ì„œ ì¿ í‚¤ë¡œë§Œ í† í°ì„ ì „ë‹¬í•˜ê³  URL ë…¸ì¶œì„ í”¼í•˜ëŠ” êµ¬ì„±ì´ ì²˜ìŒì—” ë‚¯ì„¤ì—ˆë‹¤.

* 401 ë™ì‹œ ë‹¤ë°œ ì‘ë‹µ ìƒí™©ì—ì„œ Axios ì¸í„°ì…‰í„°ë¥¼ ì§ë ¬í™”(`isRefreshing`, `refreshPromise`)í•˜ëŠ” íŒ¨í„´ì„ ì´í•´í•˜ëŠ” ë° ì‹œê°„ì´ í•„ìš”í–ˆë‹¤.

* ì¿ í‚¤ `setMaxAge`ê°€ ì´ˆ ë‹¨ìœ„ë¼ëŠ” ì ì„ ë†“ì³ ì‚­ì œ/ë§Œë£Œ íƒ€ì´ë°ì„ ì˜ëª» ì„¤ì •í•œ ì ì´ ìˆì—ˆë‹¤.

---

## ì •ë¦¬ ğŸ–‡ï¸

### 1. OAuth2 ì „ì²´ íë¦„ê³¼ ë³´ì•ˆ ì²´ì¸ êµ¬ì„±

* **í•™ìŠµ ëª©í‘œ (Why?)**
  ì™¸ë¶€ OAuth2 ê³µê¸‰ìë¥¼ í†µí•´ ë¡œê·¸ì¸ í›„, ì„œë²„ì—ì„œ JWTë¥¼ ë°œê¸‰í•´ HttpOnly ì¿ í‚¤ë¡œ ì €ì¥í•˜ê³ , ì„¸ì…˜ ì—†ì´ë„ ì¸ì¦ ìƒíƒœë¥¼ ìœ ì§€í•˜ë ¤ê³  í•¨.

* **í•µì‹¬ ì›ë¦¬ (What?)**
  `SecurityFilterChain`ì—ì„œ `oauth2Login()`ì„ í™œì„±í™”í•˜ê³ , ì„±ê³µ/ì‹¤íŒ¨ í•¸ë“¤ëŸ¬ë¥¼ í†µí•´ JWT ë°œê¸‰Â·ì‚­ì œ ë° ë¦¬ë‹¤ì´ë ‰íŠ¸ë¥¼ ìˆ˜í–‰í•¨. ì„œë¹„ìŠ¤ ì „ë°˜ì€ `STATELESS`ë¡œ ë™ì‘í•¨.

* **ë¬¸ë²• ë° ì‚¬ìš©ë²• (How?)**

  ```java
  http
    .csrf(csrf -> csrf.disable())
    .sessionManagement(sm -> sm.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
    .authorizeHttpRequests(authz -> authz
      .requestMatchers("/", "/health", "/h2-console/**",
                       "/api/auth/**", "/oauth2/**", "/login/oauth2/**").permitAll()
      .anyRequest().authenticated())
    .oauth2Login(oauth -> oauth
      .userInfoEndpoint(u -> u.userService(customOAuth2UserService))
      .successHandler(oAuth2SuccessHandler)
      .failureHandler(oAuth2FailureHandler));
  ```

* **ì£¼ì˜ì‚¬í•­ ë° ì‹¤ë¬´ íŒ (Watch out for)**
  ì¸ì¦ ì‹¤íŒ¨ëŠ” 401ë¡œ ë°˜í™˜í•´ í´ë¼ì´ì–¸íŠ¸ê°€ ì¬ë°œê¸‰ì„ íŠ¸ë¦¬ê±°í•˜ê²Œ í•¨. H2 ì½˜ì†” ë“± ê°œë°œ ë„êµ¬ ì ‘ê·¼ì—ëŠ” `frameOptions().sameOrigin()` ì„¤ì •ì´ í•„ìš”í•¨.

---

### 2. OAuth2 ì‚¬ìš©ì ì •ë³´ ë™ê¸°í™” (CustomOAuth2UserService)

* **í•™ìŠµ ëª©í‘œ (Why?)**
  ê³µê¸‰ì ì‘ë‹µì„ ìš°ë¦¬ ë„ë©”ì¸ `User`ì— ì •ê·œí™”í•˜ê³ , ì‹ ê·œ/ê¸°ì¡´ ì‚¬ìš©ìë¥¼ êµ¬ë¶„í•´ ì €ì¥/ì—…ë°ì´íŠ¸í•˜ë ¤ê³  í•¨.

* **í•µì‹¬ ì›ë¦¬ (What?)**
  `registrationId`ì— ë”°ë¼ ì‘ë‹µ ìŠ¤í‚¤ë§ˆê°€ ë‹¤ë¥´ë¯€ë¡œ providerë³„ë¡œ `providerId`, `email`, `nickname`, `profileImageUrl`ì„ ì¶”ì¶œí•˜ê³  DBì— ë™ê¸°í™”í•¨.

* **ë¬¸ë²• ë° ì‚¬ìš©ë²• (How?)**

  ```java
  String registrationId = userRequest.getClientRegistration().getRegistrationId();
  if ("google".equals(registrationId)) {
    providerId = String.valueOf(attributes.get("sub"));
    email = (String) attributes.get("email");
    nickname = coalesce((String) attributes.get("name"),
                        email != null ? email.split("@")[0] : null);
  } else if ("kakao".equals(registrationId)) {
    providerId = String.valueOf(attributes.get("id"));
    Map<String, Object> acc = (Map<String, Object>) attributes.getOrDefault("kakao_account", Map.of());
    email = (String) acc.get("email");
    Map<String, Object> profile = (Map<String, Object>) acc.getOrDefault("profile", Map.of());
    nickname = coalesce((String) profile.get("nickname"),
                        email != null ? email.split("@")[0] : null);
  }
  ```

* **ì£¼ì˜ì‚¬í•­ ë° ì‹¤ë¬´ íŒ (Watch out for)**
  KakaoëŠ” ì´ë©”ì¼ì´ ì—†ì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ `{providerId}@kakao.local` ê°™ì€ placeholder ì •ì±…ì„ ëª…í™•íˆ ë‘ê³ , ì´í›„ ì‹¤ì œ ì´ë©”ì¼ì„ ë°›ìœ¼ë©´ êµì²´í•˜ëŠ” ë¡œì§ì´ í•„ìš”í•¨.

---

### 3. Google vs Kakao ì‘ë‹µ ìŠ¤í‚¤ë§ˆ ì°¨ì´

* **í•™ìŠµ ëª©í‘œ (Why?)**
  í•„ë“œëª…ì´ ë‹¬ë¼ ë§¤í•‘ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì§€ ì•Šë„ë¡ ê³µê¸‰ìë³„ ì‘ë‹µ êµ¬ì¡°ë¥¼ ì •í™•íˆ ì´í•´í•˜ë ¤ê³  í•¨.

* **í•µì‹¬ ì›ë¦¬ (What?)**
  ì•„ë˜ í‘œëŠ” ìì£¼ ì“°ëŠ” í‘œì¤€ í•„ë“œ ëŒ€ë¹„ ê° ê³µê¸‰ì ìœ„ì¹˜ë¥¼ ì •ë¦¬í•¨.

* **ë¬¸ë²• ë° ì‚¬ìš©ë²• (How?)**

  | ê°œë…      | Google ìœ„ì¹˜ | Kakao ìœ„ì¹˜                                  |
    | ------- | --------- | ----------------------------------------- |
  | ê³ ìœ  ID   | `sub`     | `id`                                      |
  | ì´ë©”ì¼     | `email`   | `kakao_account.email`                     |
  | ë‹‰ë„¤ì„     | `name`    | `kakao_account.profile.nickname`          |
  | í”„ë¡œí•„ ì´ë¯¸ì§€ | `picture` | `kakao_account.profile.profile_image_url` |

* **ì£¼ì˜ì‚¬í•­ ë° ì‹¤ë¬´ íŒ (Watch out for)**
  KakaoëŠ” ë™ì˜ í•­ëª©ì— ë”°ë¼ í•„ë“œê°€ ë¹ ì§ˆ ìˆ˜ ìˆìŒ. ë§¤í•‘ ì‹œ ì•ˆì „ ìºìŠ¤íŒ…ê³¼ `null` ë°©ì–´ë¥¼ ì ìš©í•´ì•¼ í•¨.

---

### 4. OAuth2SuccessHandler / OAuth2FailureHandler

* **í•™ìŠµ ëª©í‘œ (Why?)**
  ë¡œê·¸ì¸ ê²°ê³¼ì— ë”°ë¼ JWT ë°œê¸‰/ì‚­ì œì™€ ë¦¬ë‹¤ì´ë ‰íŠ¸ë¥¼ ì¼ê´€ë˜ê²Œ ì²˜ë¦¬í•˜ë ¤ê³  í•¨.

* **í•µì‹¬ ì›ë¦¬ (What?)**
  ì„±ê³µ ì‹œ subjectë¡œ Access/Refresh ìƒì„± â†’ HttpOnly ì¿ í‚¤ ì €ì¥ â†’ í”„ë¡ íŠ¸ì—”ë“œ URLë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸. ì‹¤íŒ¨ ì‹œ í† í° ì¿ í‚¤ ì •ë¦¬ í›„ ì—ëŸ¬ ë©”ì‹œì§€ì™€ í•¨ê»˜ ë¦¬ë‹¤ì´ë ‰íŠ¸.

* **ë¬¸ë²• ë° ì‚¬ìš©ë²• (How?)**

  ```java
  // ì„±ê³µ
  String access = jwtTokenProvider.createAccessToken(subject, Map.of());
  String refresh = jwtTokenProvider.createRefreshToken(subject);
  cookieUtil.addAccessTokenCookie(response, access);
  cookieUtil.addRefreshTokenCookie(response, refresh);
  response.sendRedirect(appProperties.getOauth2SuccessRedirectUrl());

  // ì‹¤íŒ¨
  cookieUtil.deleteAccessTokenCookie(response);
  cookieUtil.deleteRefreshTokenCookie(response);
  response.sendRedirect(appProperties.getOauth2FailureRedirectUrl() + "?error=" + encodedMsg);
  ```

* **ì£¼ì˜ì‚¬í•­ ë° ì‹¤ë¬´ íŒ (Watch out for)**
  í† í°ì€ URL íŒŒë¼ë¯¸í„°ë¡œ ë…¸ì¶œí•˜ì§€ ë§ê³  **í•­ìƒ ì¿ í‚¤**ë¡œë§Œ ì „ë‹¬í•¨. ë¦¬ë‹¤ì´ë ‰íŠ¸ ëª©ì ì§€ëŠ” í™˜ê²½ë³€ìˆ˜(yml)ë¡œ ë¶„ë¦¬ ê´€ë¦¬í•¨.

---

### 5. JWT ì¿ í‚¤ ê¸°ë°˜ ì¸ì¦ê³¼ ë³´ì•ˆ í”Œë˜ê·¸

* **í•™ìŠµ ëª©í‘œ (Why?)**
  XSS/ìŠ¤ë‹ˆí•‘/í¬ë¡œìŠ¤ ì‚¬ì´íŠ¸ ì „ì†¡ ìœ„í—˜ì„ í”Œë˜ê·¸ ì¡°í•©ìœ¼ë¡œ ë‚®ì¶”ë ¤ í•¨.

* **í•µì‹¬ ì›ë¦¬ (What?)**

  * **HttpOnly**: JS ì ‘ê·¼ ì°¨ë‹¨ â†’ XSSë¡œë¶€í„° í† í° ë…¸ì¶œ ë°©ì§€
  * **Secure**: HTTPSì—ì„œë§Œ ì „ì†¡ â†’ ë„¤íŠ¸ì›Œí¬ íƒˆì·¨ ë°©ì§€
  * **SameSite**: `Lax/Strict/None`ì— ë”°ë¼ í¬ë¡œìŠ¤ ì‚¬ì´íŠ¸ ì¿ í‚¤ ì „ì†¡ ì œí•œ

* **ë¬¸ë²• ë° ì‚¬ìš©ë²• (How?)**

  ```java
  ResponseCookie cookie = ResponseCookie.from("access-token", token)
      .httpOnly(true).secure(true)
      .sameSite("Lax")   // cross-site í•„ìš” ì‹œ "None" (ì´ë•Œ secure=true í•„ìˆ˜)
      .path("/").maxAge(300).build();
  response.addHeader("Set-Cookie", cookie.toString());
  ```

* **ì£¼ì˜ì‚¬í•­ ë° ì‹¤ë¬´ íŒ (Watch out for)**
  SPAê°€ ë‹¤ë¥¸ ë„ë©”ì¸ì— í˜¸ìŠ¤íŒ…ë˜ë©´ `SameSite=None; Secure` ì¡°í•©ì´ í•„ìš”í•¨. ê°œë°œ(HTTP)ê³¼ ìš´ì˜(HTTPS) í”„ë¡œíŒŒì¼ì„ ë¶„ë¦¬í•´ ì„¤ì • ì‹¤ìˆ˜ë¥¼ ì¤„ì„.

---

### 6. Access Token vs Refresh Token ì „ëµ

* **í•™ìŠµ ëª©í‘œ (Why?)**
  ë³´ì•ˆì„±ê³¼ UXë¥¼ ë™ì‹œì— ë§Œì¡±í•˜ë ¤ê³  ë‹¨ê¸°/ì¥ê¸° í† í°ì„ ë¶„ë¦¬í•¨.

* **í•µì‹¬ ì›ë¦¬ (What?)**

  * **Access Token**: ì§§ê²Œ(ì˜ˆ: 5\~10ë¶„), ëª¨ë“  ë³´í˜¸ APIì— ì‚¬ìš©
  * **Refresh Token**: ê¸¸ê²Œ(ì˜ˆ: 30\~90ì¼), Access ê°±ì‹  ì „ìš©. ì„œë²„ì—ì„œ íšŒì „(rotation) ê´€ë¦¬ ê¶Œì¥

* **ë¬¸ë²• ë° ì‚¬ìš©ë²• (How?)**

  ```java
  // ìµœì´ˆ ë¡œê·¸ì¸
  cookieUtil.addAccessTokenCookie(response, accessToken);
  cookieUtil.addRefreshTokenCookie(response, refreshToken);

  // ì¬ë°œê¸‰ APIì—ì„œ Refresh ê²€ì¦ í›„ Access ì¬ë°œê¸‰
  ```

* **ì£¼ì˜ì‚¬í•­ ë° ì‹¤ë¬´ íŒ (Watch out for)**
  Refresh íƒˆì·¨ ëŒ€ë¹„ë¥¼ ìœ„í•´ UA/IP/ë§Œë£Œë¥¼ í¬í•¨í•´ ì„œë²„ ë³´ê´€Â·íšŒì „ì„ ê³ ë ¤í•¨. ë¡œê·¸ì•„ì›ƒ/ê°•ì œ ë§Œë£Œ ì‹œ ì¿ í‚¤ ì‚­ì œì™€ ì„œë²„ ìƒíƒœ íê¸°ë¥¼ í•¨ê»˜ ì²˜ë¦¬í•¨.

---

### 7. ì¬ë°œê¸‰/ë¡œê·¸ì•„ì›ƒ API (AuthController)

* **í•™ìŠµ ëª©í‘œ (Why?)**
  ì„¸ì…˜ ì—†ì´ ì¥ê¸° ë¡œê·¸ì¸ì„ ì§€ì›í•˜ê¸° ìœ„í•´ ì•ˆì „í•œ ì¬ë°œê¸‰/ì¢…ë£Œ ê²½ë¡œë¥¼ ì œê³µí•˜ë ¤ í•¨.

* **í•µì‹¬ ì›ë¦¬ (What?)**

  * `POST /api/auth/refresh`: ì¿ í‚¤ì˜ Refresh ê²€ì¦ í›„ Access ì¬ë°œê¸‰
  * `POST /api/auth/logout`: Access/Refresh ì¿ í‚¤ ì‚­ì œ

* **ë¬¸ë²• ë° ì‚¬ìš©ë²• (How?)**

  ```java
  String refresh = cookieUtil.readRefreshToken(request);
  if (refresh == null || !jwtTokenProvider.validateToken(refresh)) {
    return ResponseEntity.status(401).build();
  }
  String subject = jwtTokenProvider.getClaims(refresh).getSubject();
  String newAccess = jwtTokenProvider.createAccessToken(subject, Map.of());
  cookieUtil.addAccessTokenCookie(response, newAccess);
  return ResponseEntity.noContent().build();
  ```

* **ì£¼ì˜ì‚¬í•­ ë° ì‹¤ë¬´ íŒ (Watch out for)**
  ì¬ë°œê¸‰ ì‹¤íŒ¨ ì‹œ 401ì„ ë°˜í™˜í•´ í´ë¼ì´ì–¸íŠ¸ê°€ ì¸ì¦ ìƒíƒœë¥¼ ì´ˆê¸°í™”í•˜ê³  ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ë³´ë‚¼ ìˆ˜ ìˆê²Œ í•¨.

---

### 8. ì¿ í‚¤ ë§Œë£Œ/ì‚­ì œ ë™ì‘ (maxAgeëŠ” ì´ˆ ë‹¨ìœ„)

* **í•™ìŠµ ëª©í‘œ (Why?)**
  ì¸ì¦ ì§€ì†ì‹œê°„ê³¼ ì¦‰ì‹œ ë¡œê·¸ì•„ì›ƒ ë™ì‘ì„ ì •í™•íˆ ì œì–´í•˜ë ¤ í•¨.

* **í•µì‹¬ ì›ë¦¬ (What?)**

  * `setMaxAge(300)` â†’ **300ì´ˆ(5ë¶„)**
  * `setMaxAge(0)` â†’ **ì¦‰ì‹œ ì‚­ì œ**
  * `setMaxAge(-1)` â†’ **ì„¸ì…˜ ì¿ í‚¤**(ë¸Œë¼ìš°ì € ì¢…ë£Œ ì‹œ ì‚­ì œ)

* **ë¬¸ë²• ë° ì‚¬ìš©ë²• (How?)**

  ```java
  cookie.setMaxAge(300);  // 5ë¶„
  // ì‚­ì œ
  ResponseCookie del = ResponseCookie.from("access-token", "")
      .path("/").httpOnly(true).secure(true).maxAge(0).build();
  response.addHeader("Set-Cookie", del.toString());
  ```

* **ì£¼ì˜ì‚¬í•­ ë° ì‹¤ë¬´ íŒ (Watch out for)**
  ìƒì„±/ì‚­ì œ ì‹œ ë„ë©”ì¸Â·ê²½ë¡œÂ·í”Œë˜ê·¸ê°€ ë™ì¼í•´ì•¼ ë¸Œë¼ìš°ì €ê°€ ì›í•˜ëŠ” ì¿ í‚¤ë¥¼ ì •í™•íˆ ì‚­ì œí•¨.

---

### 9. Axios ì¸ìŠ¤í„´ìŠ¤ì™€ 401 ìë™ ì¬ë°œê¸‰ ì¸í„°ì…‰í„°

* **í•™ìŠµ ëª©í‘œ (Why?)**
  Access ë§Œë£Œ ì‹œ ì‚¬ìš©ì ê²½í—˜ì„ ëŠê¹€ ì—†ì´ ìœ ì§€í•˜ë ¤ í•¨.

* **í•µì‹¬ ì›ë¦¬ (What?)**
  `withCredentials: true`ë¡œ ì¿ í‚¤ë¥¼ ìë™ í¬í•¨í•˜ê³ , 401 ì‘ë‹µ ì‹œ `/api/auth/refresh`ë¥¼ í˜¸ì¶œí•œ ë’¤ ì‹¤íŒ¨í•œ ìš”ì²­ì„ í•œ ë²ˆë§Œ ì¬ì‹œë„í•¨. ë™ì‹œ 401ì€ `isRefreshing`/`refreshPromise`ë¡œ ì§ë ¬í™”í•¨.

* **ë¬¸ë²• ë° ì‚¬ìš©ë²• (How?)**

  ```js
  const apiClient = axios.create({ baseURL: '/api', withCredentials: true });

  let isRefreshing = false;
  let refreshPromise = null;

  apiClient.interceptors.response.use(
    (res) => res,
    async (error) => {
      const original = error?.config || {};
      const status = error?.response?.status;
      if (status !== 401 || original.skipAuthRefresh) return Promise.reject(error);

      if (original.url?.includes('/auth/refresh') || original._retry) {
        useAuthStore.getState().clear();
        return Promise.reject(error);
      }

      try {
        if (!isRefreshing) {
          isRefreshing = true;
          original._retry = true;
          const { AuthService } = await import('../services/authService');
          refreshPromise = AuthService.refresh(); // 204 ê¸°ëŒ€
          await refreshPromise;
        } else {
          await refreshPromise;
          original._retry = true;
        }
        return apiClient(original);
      } catch (e) {
        useAuthStore.getState().clear();
        throw e;
      } finally {
        isRefreshing = false;
      }
    }
  );
  ```

* **ì£¼ì˜ì‚¬í•­ ë° ì‹¤ë¬´ íŒ (Watch out for)**
  ìˆœí™˜ ì˜ì¡´ì„ í”¼í•˜ë ¤ê³  ì¸í„°ì…‰í„° ë‚´ë¶€ì—ì„œ `AuthService`ë¥¼ **ë™ì  import**í•¨. ë¬´í•œ ë£¨í”„ ë°©ì§€ë¥¼ ìœ„í•´ `_retry` í”Œë˜ê·¸ë¥¼ ì‚¬ìš©í•¨.

---

### 10. Axiosì™€ fetch ë¹„êµ (JWT ì¿ í‚¤ ì¸ì¦ ê´€ì )

* **í•™ìŠµ ëª©í‘œ (Why?)**
  í”„ë¡œì íŠ¸ ë§¥ë½ì—ì„œ ì–´ë–¤ HTTP í´ë¼ì´ì–¸íŠ¸ë¥¼ íƒí• ì§€ ê·¼ê±°ë¥¼ ëª…í™•íˆ í•˜ë ¤ í•¨.

* **í•µì‹¬ ì›ë¦¬ (What?)**

  | í•­ëª©    | fetch                       | Axios                      |
    | ----- | --------------------------- | -------------------------- |
  | ì¿ í‚¤ í¬í•¨ | `credentials: 'include'` ì§€ì • | `withCredentials: true` ì˜µì…˜ |
  | ì¸í„°ì…‰í„°  | ì§ì ‘ êµ¬í˜„ í•„ìš”                    | **ë‚´ì¥**(ìš”ì²­/ì‘ë‹µ ê³µí†µ ë¡œì§)        |
  | ì—ëŸ¬ ì²˜ë¦¬ | ìƒíƒœì½”ë“œ ìˆ˜ë™ ì²´í¬                  | 4xx/5xx ìë™ reject          |
  | JSON  | `res.json()` í˜¸ì¶œ             | `res.data` ë°”ë¡œ ì‚¬ìš©           |
  | ì‹¤í–‰ í™˜ê²½ | ë¸Œë¼ìš°ì €                        | ë¸Œë¼ìš°ì € + Node.js             |

* **ë¬¸ë²• ë° ì‚¬ìš©ë²• (How?)**

  ```js
  // fetch
  const r = await fetch('/api/users/me', { credentials: 'include' });
  const data = await r.json();

  // axios
  const r2 = await apiClient.get('/users/me'); // withCredentials ì ìš©ë¨
  const data2 = r2.data;
  ```

* **ì£¼ì˜ì‚¬í•­ ë° ì‹¤ë¬´ íŒ (Watch out for)**
  JWT ì¿ í‚¤ ì¸ì¦ + ìë™ ì¬ë°œê¸‰ íŒ¨í„´ì—ëŠ” Axiosì˜ ì¸í„°ì…‰í„°ê°€ ìœ ì§€ë³´ìˆ˜ì— ìœ ë¦¬í•¨.

---

## ì˜¤ëŠ˜ì˜ ê¹¨ë‹¬ìŒ ğŸ’¡

* OAuth2 ì—°ë™ì€ **ì‚¬ìš©ì ë™ê¸°í™” â†’ JWT ë°œê¸‰ â†’ ì¿ í‚¤ ì €ì¥ â†’ ë¦¬ë‹¤ì´ë ‰íŠ¸**ê¹Œì§€ í•˜ë‚˜ì˜ íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ ë³´ì•„ì•¼ í•¨.

* Kakao/Google ì‘ë‹µ ìŠ¤í‚¤ë§ˆ ì°¨ì´ëŠ” ë§¤í•‘ ì‹¤ìˆ˜ë¡œ ì´ì–´ì§€ê¸° ì‰¬ìš°ë¯€ë¡œ í‘œì¤€í™” ê³„ì¸µì„ ë‘¬ì•¼ í•¨.

* ì¿ í‚¤ `maxAge`ëŠ” **ì´ˆ ë‹¨ìœ„**ì´ë©°, ì‚­ì œëŠ” `0`, ì„¸ì…˜ ì¿ í‚¤ëŠ” `-1`ì„ì„ í™•ì‹¤íˆ ê¸°ì–µí•´ì•¼ í•¨.

* Axios ì¸í„°ì…‰í„°ì™€ ë™ì  import íŒ¨í„´ìœ¼ë¡œ 401 ìë™ ì¬ë°œê¸‰ì„ ì•ˆì •ì ìœ¼ë¡œ êµ¬í˜„í•  ìˆ˜ ìˆìŒ.

* í´ë¼ì´ì–¸íŠ¸ì—ëŠ” í† í°ì„ ì €ì¥í•˜ì§€ ì•Šê³ , ì„œë²„ê°€ **HttpOnly ì¿ í‚¤**ë¡œë§Œ í† í°ì„ ê´€ë¦¬í•˜ëŠ” ë°©ì‹ì´ ë³´ì•ˆì ìœ¼ë¡œ ì„¤ë“ë ¥ ìˆìŒ.
