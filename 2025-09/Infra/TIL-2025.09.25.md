# TIL - 2025.09.25 - EC2 웹서버 · IAM 역할 · 네트워크 · EBS 개념 이해

## 카테고리 🏷️

#TIL #AWS #EC2 #IAM #SecurityGroup #ElasticIP #ENI #EBS #Snapshot #CLI

---

## 오늘 배운 내용 🔍

* EC2 Linux 인스턴스에 Apache(httpd) 설치 및 기본 웹서버 구동
* vi로 `index.html` 작성 및 브라우저에서 확인
* EC2에 IAM 역할(Instance Profile) 부여 후 AWS CLI 권한 동작 검증
* ENI, Public/Private IP, Elastic IP의 개념과 과금 주의사항
* 보안 그룹의 인바운드/아웃바운드 규칙과 허용 중심 모델
* EBS 볼륨의 생성·연결·분리·삭제, 스냅샷으로 백업·복구 흐름

---

## 어려웠던 점 💣

* IAM 역할을 붙이기 전·후에 CLI 동작 차이를 개념적으로는 알았지만, 실제 오류 메시지를 보고 원인이 “역할 미부여”임을 빠르게 연관 짓는 데 시간이 걸렸다.

* Elastic IP가 “고정 공인 IP”라는 점은 이해했으나, 인스턴스와 미연결·중지 상태에서 과금되는 조건을 정리해 기억하기가 혼동되었다.

* 보안 그룹이 “허용만 정의(deny 불가)”라는 특성 때문에 기본 차단의 사고방식과 충돌하여 규칙 설계 시 발상 전환이 필요했다.

---

## 정리 🖇️

### 1. EC2 Linux 인스턴스 웹서버 실습

* **학습 목표 (Why?)**
  가장 기본적인 IaaS 사용법인 “가상 서버 생성 → 웹서버 설치 → 서비스 확인”을 한 사이클로 경험하여 클라우드 운용 감각을 익힌다.

* **핵심 원리 (What?)**
  EC2는 AWS의 가상 머신 서비스다. 패키지 관리자로 Apache(httpd)를 설치·기동하고, 기본 문서 루트(`/var/www/html`)에 HTML을 배치하면 브라우저로 접근해 결과를 확인할 수 있다.

* **문법 및 사용법 (How?)**

  ```bash
  sudo su
  yum update -y
  yum install httpd -y
  service httpd start
  chkconfig httpd on
  cd /var/www/html
  vi index.html
  ```

  ```html
  <!DOCTYPE html>
  <html lang="ko">
  <head>
    <meta charset="UTF-8">
    <title>my ec2 instance</title>
  </head>
  <body>
    <h1>얌냠냠 옴뇽뇽~~</h1>
  </body>
  </html>
  ```

  * EC2 세부 정보의 **퍼블릭 IP** 또는 **퍼블릭 DNS**로 접속하여 페이지 로딩 확인

* **주의사항 및 실무 팁 (Watch out for)**

  * 보안 그룹 인바운드에 **HTTP(80)** 허용이 없으면 브라우저 접근 불가
  * `chkconfig httpd on`은 부팅 시 자동 기동 목적이며, Amazon Linux 2에서는 `systemctl enable --now httpd`를 사용한다.

---

### 2. EC2에 IAM 역할 부여 및 CLI 동작 검증

* **학습 목표 (Why?)**
  인스턴스가 외부 자격 증명 없이도 안전하게 AWS API를 호출하도록 \*\*인스턴스 프로파일(역할)\*\*을 부여하는 표준 절차를 이해한다.

* **핵심 원리 (What?)**

  * EC2는 **IAM 역할**을 통해 임시 자격 증명(STS)을 자동 주입받아 `aws` CLI가 동작한다.

  * 역할이 없으면 `aws iam list-roles` 같은 호출은 **AccessDenied**로 실패한다.

* **문법 및 사용법 (How?)**

  1. IAM → 역할 생성 → **사용 사례: EC2** 선택
  2. 권한 정책 **IAMReadOnlyAccess** 첨부 → 역할 생성
  3. EC2 대시보드 → 인스턴스 선택 → **작업 → 보안 → IAM 역할 수정** → 방금 만든 역할 연결
  4. 인스턴스에서:

     ```bash
     aws iam list-roles
     aws iam list-users
     ```

    * 역할 부여 전: 권한 오류

    * 역할 부여 후: 목록 조회 성공

* **주의사항 및 실무 팁 (Watch out for)**

  * 최소권한 원칙: 실습 외에는 ReadOnly 대신 필요한 서비스의 최소 범위 정책으로 한정
  * 크리덴셜 파일(\~/.aws/credentials)보다 역할 주입이 우선되는 실행 환경을 선호

---

### 3. ENI, Public/Private IP, Elastic IP

* **학습 목표 (Why?)**
  네트워크 인터페이스와 공인/사설 IP, 고정 공인 IP(Elastic IP)의 관계를 파악해 배포·장애 대응·비용 이슈를 줄인다.

* **핵심 원리 (What?)**

  * **ENI**: 가상 NIC. IP/MAC를 보유하며 인스턴스에 부착됨

  * **Private IP**: VPC 내부 통신용

  * **Public IP**: 인터넷 통신용(재시작 시 변경 가능)

  * **Elastic IP(EIP)**: 고정 공인 IP. ENI에 연결하면 인스턴스 재시작 후에도 IP 고정

* **문법 및 사용법 (How?)**

  * 콘솔에서 **탄력적 IP** 할당 → **작업 → 탄력적 IP 주소 연결** → 대상 인스턴스/프라이빗 IP 선택

  * 연결 후 인스턴스 상세의 퍼블릭 IP가 EIP로 표시됨

* **주의사항 및 실무 팁 (Watch out for)**

  * **과금 주의**:

    1. EIP가 인스턴스에 미연결, 2) 연결돼 있지만 인스턴스가 **중지** 상태인 경우 시간당 과금
  * 인스턴스 삭제 시 EIP도 **해제+릴리스**를 수행해 비용 누수 방지

---

### 4. 보안 그룹(Security Group) 모델

* **학습 목표 (Why?)**
  인스턴스 단위 방화벽의 동작 방식을 이해하고 최소 개방 원칙으로 안전한 접근 제어를 설계한다.

* **핵심 원리 (What?)**

  * 보안 그룹은 **허용 규칙만** 정의하며, 기본 거부다.

  * 인바운드(외→내)는 기본 무허용, 아웃바운드(내→외)는 기본 허용이 일반적 기본값.

* **문법 및 사용법 (How?)**

  * 인바운드 예:

    * SSH: TCP 22, 소스는 사무실 고정 IP로 한정 권장

    * HTTP: TCP 80, 소스 0.0.0.0/0(공개 서비스)

    * HTTPS: TCP 443, 소스 0.0.0.0/0

* **주의사항 및 실무 팁 (Watch out for)**

  * 운영 서버의 SSH 22는 가급적 **고정 대역 화이트리스트**
  * 내부 호출은 **보안 그룹 참조**(SG→SG)로 관리하면 IP 변경 이슈 감소

---

### 5. EBS 볼륨과 스냅샷

* **학습 목표 (Why?)**
  인스턴스 저장 계층 관리(추가 볼륨, 백업/복구)를 표준화해 데이터 유실과 운영 중단을 줄인다.

* **핵심 원리 (What?)**

  * **EBS**: EC2에 붙이는 블록 스토리지. **동일 AZ**에서만 부착 가능

  * **스냅샷**: EBS 볼륨 백업(증분). 스냅샷으로 새 볼륨 생성·연결 가능

* **문법 및 사용법 (How?)**

  * 볼륨: 콘솔 **볼륨** → 생성(크기/타입/KMS 암호화) → 대상 인스턴스에 **연결**

  * 스냅샷: 콘솔 **스냅샷** → 스냅샷 생성(원본 볼륨 선택) → **스냅샷에서 볼륨 생성** → 인스턴스에 연결

* **주의사항 및 실무 팁 (Watch out for)**

  * 인스턴스 종료 후 **루트 볼륨 잔존 시 과금** 발생 → 수명 관리 필요
  * 스냅샷은 리전 단위. 리전 간 복제·공유 전략이 필요하면 카탈로그화

---

### 6. 추가: Node.js/React 개발 환경 부트스트랩

* **학습 목표 (Why?)**
  웹서버 실습에 더해 애플리케이션 런타임과 프로젝트 시드를 신속히 준비한다.

* **핵심 원리 (What?)**
  패키지 매니저로 Node.js 22를 설치하고 Vite 템플릿으로 React 앱 골격을 생성한다.

* **문법 및 사용법 (How?)**

  ```bash
  sudo dnf install -y nodejs22 nodejs22-npm
  npm create vite@latest MyReactApp
  ```

* **주의사항 및 실무 팁 (Watch out for)**

  * 프로덕션 배포는 Nginx/ALB 등과 연계, CI/CD로 무중단 전략을 고려

---

## 오늘의 깨달음 💡

* 인스턴스 프로파일을 통한 **역할 기반 자격 증명** 흐름을 실제로 확인하니, 키 파일을 배포하지 않고도 안전하게 API를 호출하는 표준 패턴이 명확해졌다.

* **Elastic IP의 비용 조건**과 **보안 그룹의 허용만 정의**라는 모델은 비용/보안 사고의 빈번한 원인이므로, 배포 체크리스트에 포함해 예방하는 것이 실무적으로 중요하다고 판단했다.

* 스냅샷 기반 복구는 단순 백업을 넘어 **환경 복제와 신속 복구**의 핵심 수단이므로, 주기·보존·리전 전략을 문서화해야 한다.
